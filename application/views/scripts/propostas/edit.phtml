<?= $this->render('common/top-bar-edit.phtml')?>
<div class="container">
	<?= $this->render('common/message.phtml'); ?>
	<?= $this->form; ?>
	
	<?php if(isset($this->form->id)): ?>	
	<form class="form" method="post"
		action="<?= $this->baseUrl(). '/propostas/condicoes-pagamento'?>">
		<?= $this->form->id; ?>
		<div class="form-group">
			<input type="submit" value="Adicionar / alterar condições de pagamento" class="btn btn-info" />
		</div>
	</form>
	<?php endif; ?>	
	
	
	<?php if($this->anexos) :?>		
			<table class='table table-stripped table-condensed'>
		<thead>
			<tr>
				<th>Nome</th>
				<th>Tamanho</th>
				<th class="text-center">Extensão</th>
				<th>Modificado</th>
				<th class="text-center" >Remover</th>
			</tr>
		</thead>	
    	<?php foreach ($this->anexos as $file) : ?>
    		<tbody>
			<tr>
				<td><a target="_blank" class="btn btn-link"
					href="<?= $this->baseUrl() .'/uploads/' . $file['name']; ?>">
    						<?= $file['name']; ?>
    					</a></td>
				<td>
    					<?= $this->gereDocs->formatSizeUnits($file['size']); ?>
    				</td>
				<td class="text-center">
    					<?= $file['extension']; ?>
    				</td>
				<td>
    					<?= date('d/m/Y H:i:s', $file['date'])?>
    				</td>
    			<td class="text-center" >
    				<a class="btn btn-danger removefile" href="<?= $file['name'] ?>" >
    					<i class="glyphicon glyphicon-remove" ></i>
    				</a>
    			</td>
			</tr>
		</tbody>
    	<?php endforeach; ?>
    		</table>    	
	<?php endif; ?>	
	
	<?php if(isset($this->form->id)): ?>	
	<form class="form" method="post"
		action="<?= $this->baseUrl(). '/propostas/anexos'?>">
		<?= $this->form->id; ?>
		<div class="form-group">
			<input type="submit" value="Adicionar anexos" class="btn btn-info" />
		</div>
	</form>
	<?php endif; ?>	

</div>
<script>
	$("#data_nasc, #conj_data_nasc").datetimepicker({
		format: 'DD/MM/YYYY'
	});	

	$(".removefile").click(function(e){		
		e.preventDefault();
		var self = this;
		
		var file = $(this).attr('href');
		bootbox.confirm('Remover o arquivo: ' + file + '?',function(result){

			var formdata = new FormData();
			formdata.append("names", file);			
			
			if(result){
				$.ajax({
					type: 'POST',
					url:'<?= $this->baseUrl() . '/documentos/remove-files' ?>',
					data: formdata,
					processData: false,
					contentType: false,
				}).success(function(data, textStatus){
					var data = JSON.parse(data);
					if(data[0].removed){
						$(self).parents('tr').remove();
					}
				});
			}
		});
	});
</script>